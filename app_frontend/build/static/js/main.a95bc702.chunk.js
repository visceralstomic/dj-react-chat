(this.webpackJsonpapp_frontend=this.webpackJsonpapp_frontend||[]).push([[0],{69:function(e,t,c){},70:function(e,t,c){},83:function(e,t,c){},84:function(e,t,c){},85:function(e,t,c){"use strict";c.r(t);var a,n=c(1),r=c.n(n),s=c(17),o=c.n(s),i=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,106)).then((function(t){var c=t.getCLS,a=t.getFID,n=t.getFCP,r=t.getLCP,s=t.getTTFB;c(e),a(e),n(e),r(e),s(e)}))},u=c(8),j=c(22),l=c(6),d=function(e,t){switch(t.type){case"SET_USER":return Object(l.a)(Object(l.a)({},e),{},{user:{uid:t.data.id,username:t.data.username,photo:t.data.photo},loading:!1});case"LOGOUT":return{chat:{currentRoom:null,rooms:[],participants:[]},user:{uid:"",username:"",photo:""},loading:!0};default:return e}},b=c(20),O={user:{uid:"",username:"",photo:null},chat:{currentRoom:null,rooms:[],participants:[]},loading:!0},h=(a={chat:function(e,t){switch(t.type){case"SET_CHAT_ROOM":return Object(l.a)(Object(l.a)({},e),{},{chat:Object(l.a)(Object(l.a)({},e.chat),{},{currentRoom:t.data})});case"ADD_CHAT_ROOM":return Object(l.a)(Object(l.a)({},e),{},{chat:Object(l.a)(Object(l.a)({},e.chat),{},{rooms:[].concat(Object(b.a)(e.chat.rooms),[t.data])})});case"SET_ROOM_LIST":return Object(l.a)(Object(l.a)({},e),{},{chat:Object(l.a)(Object(l.a)({},e.chat),{},{rooms:t.data})});case"DELETE_ROOM":var c=e.chat.rooms.filter((function(e){return e.id!==t.data.id}));return Object(l.a)(Object(l.a)({},e),{},{chat:{currentRoom:null,rooms:c,participants:[]}});case"SET_PARTICIPANTS":return Object(l.a)(Object(l.a)({},e),{},{chat:Object(l.a)(Object(l.a)({},e.chat),{},{participants:t.data})});case"ADD_PARTICIPANT":return Object(l.a)(Object(l.a)({},e),{},{chat:Object(l.a)(Object(l.a)({},e.chat),{},{participants:[].concat(Object(b.a)(e.chat.participants),[t.data])})});case"DELETE_PARTICIPANT":var a=e.chat.participants.filter((function(e){return e.id!==t.data.id}));return Object(l.a)(Object(l.a)({},e),{},{chat:Object(l.a)(Object(l.a)({},e.chat),{},{participants:a})});case"SET_NO_ROOM":return Object(l.a)(Object(l.a)({},e),{},{chat:Object(l.a)(Object(l.a)({},e.chat),{},{currentRoom:null})});default:return e}},user:d},function(e,t){return Object.keys(a).reduce((function(e,c){return Object(l.a)(Object(l.a)({},e),a[c](Object(j.a)({},c,e[c]),t))}),e)}),m=c(41),f=c.n(m),p="peaceful-river-84601.herokuapp.com",x="".concat("wss","://").concat(p),g="".concat("https","://").concat(p),v=f.a.create({baseURL:g,withCredentials:!0,xsrfHeaderName:"X-CSRFToken",xsrfCookieName:"csrftoken"}),S=function(e){return v.post("/users/login/",e).then((function(e){return e.data}))},N=function(){return v.get("/users/logout/").then((function(e){return e.data}))},C=function(){return v.get("/users/get_user/").then((function(e){return e.data}))},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return v.get("/users/?".concat(e)).then((function(e){return e.data}))},w=function(e){return v.post("/users/",e,{headers:{"content-type":"multipart/form-data"}}).then((function(e){return e.data}))},y=c(2),R=Object(n.createContext)(),E=function(e){var t=e.children,c=Object(n.useReducer)(h,O),a=Object(u.a)(c,2),r=a[0],s=a[1];return Object(n.useEffect)((function(){localStorage.getItem("IsLoggedIn")&&C().then((function(e){s({type:"SET_USER",data:{id:e.id,username:e.username,photo:e.photo}})})).catch((function(e){console.error(e)}))}),[]),Object(y.jsx)(R.Provider,{value:[r,s],children:t})},_=(c(68),c(69),c(70),c(16)),k=function(e){var t=e.photo;return console.log("photo",t),Object(y.jsx)(y.Fragment,{children:null!==t?Object(y.jsx)("img",{className:"user-photo",src:"".concat(t),width:"37",height:"37",alt:"img"}):Object(y.jsx)(_.d,{className:"alt-user-photo"})})},I=function(e){return new Intl.DateTimeFormat("en-US",{dateStyle:"short",timeStyle:"short"}).format(new Date(e))},A=function(e){var t=e.author,c=e.text,a=e.user,n=e.date;return Object(y.jsxs)("div",{className:"chat-message ".concat(t.id===a.uid?"sender":""),children:[Object(y.jsx)(k,{photo:(t.photo,t.photo)}),Object(y.jsxs)("div",{className:"message-text",children:[Object(y.jsx)("div",{className:"info-username",children:t.username}),c,Object(y.jsx)("div",{className:"info-date",children:I(n)})]})]})},L=function(e){return v.post("/chat/room/",e).then((function(e){return e.data}))},P=function(){return v.get("/chat/room/").then((function(e){return e.data}))},D=function(e){return v.post("/chat/participant/",e).then((function(e){return e.data}))},F=function(e){return v.get("/chat/participant/?room_id=".concat(e)).then((function(e){return e.data}))},M=function(e){return v.delete("/chat/room/".concat(e)).then((function(e){return e.data}))},U=function(e){return console.log("delete",typeof e),v.delete("/chat/participant/".concat(e)).then((function(e){return e.data}))},H=c(86),J=c(87),G=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),c=t[0],a=t[1],r=c.chat.currentRoom,s=c.chat.participants;return Object(y.jsx)(H.a,{className:"partic-list",children:s.map((function(e){return Object(y.jsxs)(J.a,{className:"partic-item",children:[e.user.username,e.user.id===r.creator.id?Object(y.jsx)(_.b,{style:{color:"hsl(353, 59%, 43%)"}}):c.user.uid===r.creator.id?Object(y.jsx)(_.c,{onClick:function(t){return c=e.id,void(window.confirm("Are you sure you want to delete this user from this room?")&&U(c).then((function(e){a({type:"DELETE_PARTICIPANT",data:{id:c}})})).catch((function(e){console.error(e)})));var c},style:{color:"hsl(350, 99%, 50%)",cursor:"pointer"}}):null]},e.id)}))})},B=c(90),q=c(88),z=c(89),V=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),c=t[0],a=t[1],r=Object(n.useState)([]),s=Object(u.a)(r,2),o=s[0],i=s[1],j=c.chat.currentRoom;Object(n.useEffect)((function(){j&&T("part_room=".concat(j.id)).then((function(e){i(e.map((function(e){return Object(l.a)(Object(l.a)({},e),{},{toAdd:!1})})))})).catch((function(e){console.log(e)}))}),[j]);var d=function(e){var t=e.target,c=t.checked,a=t.value;i(o.map((function(e){return e.id===parseInt(a)?Object(l.a)(Object(l.a)({},e),{},{toAdd:c}):e})))};return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(H.a,{className:"partic-list",children:o.length>0?o.map((function(e){return Object(y.jsx)(J.a,{className:"partic-item",children:Object(y.jsxs)(q.a,{check:!0,children:[Object(y.jsx)(z.a,{value:e.id,type:"checkbox",checked:o.toAdd,onChange:d}),e.username]})},e.id)})):Object(y.jsx)("div",{children:"There are no users to add"})}),Object(y.jsx)(B.a,{onClick:function(e){if(window.confirm("Are you sure you want to add this user(s) to the room ?")){var t=[];for(var n in o)o[n].toAdd&&t.push(D({user:o[n].id,room:c.chat.currentRoom.id}));Promise.all(t).then((function(e){e.forEach((function(e){var t=o.find((function(t){return t.id===e.user}));delete t.toAdd;var c={id:e.id,user:t,room:e.room};i((function(t){return t.filter((function(t){return t.id!==e.user}))})),a({type:"ADD_PARTICIPANT",data:c})}))}))}},disabled:0===o.length&&!0,children:"Add users to room"})]})},W=c(105),X=c(91),K=c(92),Q=c(93),Y=c(94),Z=c(95),$=c(96),ee=c(97),te=c(98),ce=c(5),ae=c.n(ce),ne=function(e){var t=e.show,c=e.setShow,a=Object(n.useState)("1"),r=Object(u.a)(a,2),s=r[0],o=r[1],i=Object(n.useContext)(R),j=Object(u.a)(i,2),l=j[0],d=j[1],b=function(e){s!==e&&o(e)},O=function(){return c(!1)};return Object(y.jsxs)(W.a,{isOpen:t,size:"sm",toggle:O,backdrop:"static",centered:!0,keyboard:!1,children:[Object(y.jsx)(X.a,{toggle:O,children:"Room menu"}),Object(y.jsxs)(K.a,{children:[Object(y.jsxs)(Q.a,{tabs:!0,children:[Object(y.jsx)(Y.a,{className:"tab-item",children:Object(y.jsx)(Z.a,{className:"".concat(ae()({active:"1"===s})," text-dark"),onClick:function(){b("1")},children:"Participants"})}),l.user.uid===l.chat.currentRoom.creator.id?Object(y.jsx)(Y.a,{className:"tab-item",children:Object(y.jsx)(Z.a,{className:"".concat(ae()({active:"2"===s})," text-dark"),onClick:function(){b("2")},children:"Users"})}):null]}),Object(y.jsxs)($.a,{activeTab:s,children:[Object(y.jsx)(ee.a,{tabId:"1",children:Object(y.jsx)(H.a,{className:"partic-list",children:Object(y.jsx)(G,{})})}),l.user.uid===l.chat.currentRoom.creator.id?Object(y.jsx)(ee.a,{tabId:"2",children:Object(y.jsx)(H.a,{className:"partic-list",children:Object(y.jsx)(V,{})})}):null]})]}),Object(y.jsxs)(te.a,{children:[l.user.uid===l.chat.currentRoom.creator.id?Object(y.jsx)(B.a,{color:"danger",onClick:function(e){window.confirm("Are you sure you want to delete this room ?")&&M(l.chat.currentRoom.id).then((function(e){d({type:"DELETE_ROOM",data:{id:l.chat.currentRoom.id}})}))},children:"Delete"}):null,Object(y.jsx)(B.a,{variant:"secondary",onClick:O,children:"Close"})]})]})},re=function(e){var t=Object(n.useState)([]),c=Object(u.a)(t,2),a=c[0],r=c[1],s=Object(n.useState)(""),o=Object(u.a)(s,2),i=o[0],j=o[1],l=Object(n.useState)(!1),d=Object(u.a)(l,2),O=d[0],h=d[1],m=Object(n.useContext)(R),f=Object(u.a)(m,2),p=f[0],g=f[1],v=Object(n.useState)(!1),S=Object(u.a)(v,2),N=(S[0],S[1],Object(n.useState)(!1)),C=Object(u.a)(N,2),T=(C[0],C[1],Object(n.useRef)(null)),w=Object(n.useRef)(),E=p.chat.currentRoom;Object(n.useEffect)((function(){w.current.scrollIntoView({behavior:"auto"})}),[a]),Object(n.useEffect)((function(){E&&F(E.id).then((function(e){g({type:"SET_PARTICIPANTS",data:e})})),j(""),h(!1)}),[E]),Object(n.useEffect)((function(){return T.current=new WebSocket("".concat(x,"/ws/chat/").concat(E.id,"/")),T.current.addEventListener("open",(function(e){console.log("OPEN!"),T.current.send(JSON.stringify({command:"fetch_messages"}))})),T.current.addEventListener("close",(function(e){console.error(e)})),T.current.addEventListener("message",(function(e){var t=JSON.parse(e.data);switch(t.command){case"messages":r(t.messages);break;case"new_message":r((function(e){return[].concat(Object(b.a)(e),[t.message])})),j("")}})),function(){return T.current.close()}}),[E]);return Object(y.jsxs)("div",{className:"chat-area",children:[Object(y.jsxs)("div",{className:"chat-header",children:[Object(y.jsx)(_.a,{onClick:function(){g({type:"SET_NO_ROOM"})},className:"to-side-bar"}),E.name,Object(y.jsx)("div",{className:"header-buttons",children:Object(y.jsx)(B.a,{onClick:function(){return h(!0)},children:"Menu"})})]}),Object(y.jsxs)("div",{className:"chat-log",children:[a.map((function(e){return Object(y.jsx)(A,{author:e.author,text:e.text,user:p.user,date:e.create_date},e.create_date)})),Object(y.jsx)("div",{style:{float:"left",clear:"both"},ref:w})]}),Object(y.jsxs)("div",{className:"chat-input-panel",children:[Object(y.jsx)("textarea",{className:"message-input",value:i,onChange:function(e){var t=e.target;return j(t.value)},type:"text",cols:"30",rows:"1"}),Object(y.jsx)(B.a,{onClick:function(e){""!==i.trim()&&T.current.send(JSON.stringify({message:i,command:"new_message",from:{id:p.user.uid,username:p.user.username}}))},children:"Send"})]}),Object(y.jsx)(ne,{show:O,setShow:h})]})},se=c(11),oe=c(99),ie=c(100),ue=function(e){var t=e.toggle,c=e.setToggle,a=Object(n.useContext)(R),r=Object(u.a)(a,2),s=(r[0],r[1]),o=Object(n.useState)(""),i=Object(u.a)(o,2),j=i[0],l=i[1],d=Object(n.useState)(""),b=Object(u.a)(d,2),O=b[0],h=b[1],m=Object(n.useState)(null),f=Object(u.a)(m,2),p=f[0],x=f[1],g=Object(se.g)(),v=(Object(se.h)().state||{from:{pathname:"/"}}).from;return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h3",{children:"Login"}),Object(y.jsxs)(oe.a,{onSubmit:function(e){e.preventDefault(),S({username:j,password:O}).then((function(e){s({type:"SET_USER",data:{id:e.id,username:e.username,photo:e.photo}}),localStorage.setItem("IsLoggedIn",!0),g.replace(v)})).catch((function(e){x(e.response.data.error),setTimeout((function(){x(null)}),7e3)}))},children:[Object(y.jsxs)(ie.a,{children:[Object(y.jsx)(q.a,{for:"usernameinput",children:"Username"}),Object(y.jsx)(z.a,{id:"usernameinput",type:"text",value:j,onChange:function(e){var t=e.target;return l(t.value)},invalid:null!==p})]}),Object(y.jsxs)(ie.a,{children:[Object(y.jsx)(q.a,{for:"passwordinput",children:"Password"}),Object(y.jsx)(z.a,{id:"passwordinput",type:"password",value:O,onChange:function(e){var t=e.target;return h(t.value)},invalid:null!==p})]}),p?Object(y.jsx)(ie.a,{className:"error-message",children:p}):null,Object(y.jsxs)(ie.a,{className:"form-btns",children:[Object(y.jsx)(B.a,{children:"Log in"}),Object(y.jsxs)("span",{children:["Not registered ?  ",Object(y.jsx)("br",{}),"  Then ",Object(y.jsx)("span",{className:"auth-toggle",onClick:function(){return c(!t)},children:"Sign up"})]})]})]})]})},je=c(101),le=function(e){var t=e.message;return Object(y.jsx)(je.a,{children:t})},de=function(e){var t=e.toggle,c=e.setToggle,a=Object(n.useState)(""),r=Object(u.a)(a,2),s=r[0],o=r[1],i=Object(n.useState)(""),j=Object(u.a)(i,2),l=j[0],d=j[1],b=Object(n.useState)(""),O=Object(u.a)(b,2),h=O[0],m=O[1],f=Object(n.useState)(null),p=Object(u.a)(f,2),x=p[0],g=p[1],v=Object(n.useState)(void 0),S=Object(u.a)(v,2),N=S[0],C=S[1],T=Object(n.useState)(void 0),R=Object(u.a)(T,2),E=R[0],_=R[1],k=Object(n.useState)(void 0),I=Object(u.a)(k,2),A=I[0],L=I[1],P=Object(n.useState)(void 0),D=Object(u.a)(P,2),F=D[0],M=D[1],U=Object(n.useState)(null),H=Object(u.a)(U,2),J=H[0],G=H[1];return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h3",{children:"Register"}),Object(y.jsxs)(oe.a,{onSubmit:function(e){e.preventDefault();var a=new FormData;a.append("username",s),a.append("password",l),a.append("password2",h),x&&(console.log(x),a.append("photo",x,x.name)),C(void 0),_(void 0),L(void 0),M(void 0),G(null),w(a).then((function(e){c(!t)})).catch((function(e){for(var t in console.log(e.response.data),e.response.data)switch(t){case"username":C(e.response.data[t]);break;case"password":_(e.response.data[t]);break;case"password2":L(e.response.data[t]);break;case"photo":M(e.response.data[t]);break;default:G(e.response.data[t])}}))},children:[Object(y.jsxs)(ie.a,{children:[Object(y.jsx)(q.a,{for:"usernameinput",children:"Username"}),Object(y.jsx)(z.a,{id:"usernameinput",type:"text",value:s,onChange:function(e){var t=e.target;return o(t.value)},invalid:void 0!==N}),N?Object(y.jsx)(le,{message:N}):null]}),Object(y.jsxs)(ie.a,{children:[Object(y.jsx)(q.a,{for:"passwordinput",children:"Password"}),Object(y.jsx)(z.a,{id:"passwordinput",type:"password",value:l,onChange:function(e){var t=e.target;return d(t.value)},invalid:void 0!==E||null!==J}),E?Object(y.jsx)(le,{message:E}):null]}),Object(y.jsxs)(ie.a,{children:[Object(y.jsx)(q.a,{for:"passwor2dinput",children:"Repeat password"}),Object(y.jsx)(z.a,{id:"passwor2dinput",type:"password",value:h,onChange:function(e){var t=e.target;return m(t.value)},invalid:void 0!==A||null!==J}),A?Object(y.jsx)(le,{message:A}):null,J?Object(y.jsx)(le,{message:J}):null]}),Object(y.jsxs)(ie.a,{children:[Object(y.jsx)(q.a,{for:"userPhoto",children:"Photo"}),Object(y.jsx)(z.a,{type:"file",name:"file",id:"userPhoto",accept:"image/*",onChange:function(e){var t=e.target;return g(t.files[0])},invalid:void 0!==F}),F?Object(y.jsx)(le,{message:F}):null]}),Object(y.jsxs)(ie.a,{className:"form-btns",children:[Object(y.jsx)(B.a,{color:"success",children:"Create account"}),Object(y.jsxs)("span",{children:["Already registered?  ",Object(y.jsx)("br",{}),"Then ",Object(y.jsx)("span",{className:"auth-toggle",onClick:function(){return c(!t)},children:"Log in"})]})]})]})]})},be=function(e){var t=Object(n.useState)(!1),c=Object(u.a)(t,2),a=c[0],r=c[1];return Object(y.jsx)("div",{className:"auth-container",children:a?Object(y.jsx)(de,{toggle:a,setToggle:r}):Object(y.jsx)(ue,{toggle:a,setToggle:r})})},Oe=(c(83),function(e){var t=Object(n.useContext)(R),c=Object(u.a)(t,2),a=c[0],r=c[1];return Object(n.useEffect)((function(){P().then((function(e){console.log(e),r({type:"SET_ROOM_LIST",data:e})})).catch((function(e){console.error(e)}))}),[]),Object(y.jsx)("div",{className:"room-list",children:a.chat.rooms.map((function(e){var t={borderLeft:e.creator.id===a.user.uid?"15px solid hsl(353, 59%, 43%)":""};return Object(y.jsxs)("button",{style:t,onClick:function(){return r({type:"SET_CHAT_ROOM",data:e})},children:[e.name," ",e.creator.id===a.user.uid?Object(y.jsx)(_.b,{style:{color:"hsl(353, 59%, 43%)"}}):null]},e.id)}))})}),he=function(e){var t=Object(n.useContext)(R),c=Object(u.a)(t,2),a=c[0],r=c[1],s=Object(n.useState)(""),o=Object(u.a)(s,2),i=o[0],j=o[1],d=Object(n.useState)(null),b=Object(u.a)(d,2),O=b[0],h=b[1];return Object(y.jsx)(y.Fragment,{children:Object(y.jsxs)(oe.a,{onSubmit:function(e){e.preventDefault(),""!==i.trim()&&L({name:i}).then((function(e){r({type:"ADD_CHAT_ROOM",data:Object(l.a)(Object(l.a)({},e),{},{creator:{id:a.user.uid,username:a.user.username}})}),j("")})).catch((function(e){h(e.response.data.name)}))},children:[Object(y.jsxs)(ie.a,{className:"position-relative chat-form-input",children:[Object(y.jsx)(z.a,{value:i,onChange:function(e){null!==O&&h(null),j(e.target.value)},placeholder:"Add chat room",invalid:null!==O,required:!0}),Object(y.jsx)(je.a,{tooltip:!0,children:O})]}),Object(y.jsx)(ie.a,{children:Object(y.jsx)(B.a,{children:"Enter"})})]})})},me=c(102),fe=c(103),pe=c(104),xe=function(e){var t=Object(n.useContext)(R),c=Object(u.a)(t,2),a=(c[0],c[1]),r=Object(se.g)();return Object(y.jsx)("div",{children:Object(y.jsx)(B.a,{onClick:function(e){N().then((function(e){a({type:"LOGOUT"}),console.log("LOGOUT"),localStorage.removeItem("IsLoggedIn"),r.replace("/auth")})).catch((function(e){console.log(e)}))},children:"Logout"})})},ge=c(18),ve=c(44),Se=["children","auth"],Ne=function(e){var t=e.children,c=(e.auth,Object(ve.a)(e,Se)),a=localStorage.getItem("IsLoggedIn");return Object(y.jsx)(se.b,Object(l.a)(Object(l.a)({},c),{},{render:function(e){var c=e.location;return a?t:Object(y.jsx)(se.a,{to:{pathname:"/auth",state:{from:c}}})}}))},Ce=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),c=t[0],a=(t[1],c.chat.currentRoom);return Object(y.jsx)("div",{className:"app",children:Object(y.jsx)(ge.a,{children:Object(y.jsxs)(se.d,{children:[Object(y.jsx)(Ne,{exact:!0,path:"/",children:Object(y.jsx)("div",{className:"chat-container ".concat(c.chat.currentRoom?"active-room":"no-active-room"),children:c.loading?Object(y.jsx)("div",{className:"loader",children:Object(y.jsx)(pe.a,{color:"dark"})}):Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)("div",{className:"side-bar",children:[Object(y.jsxs)("div",{className:"side-header",children:[Object(y.jsxs)("div",{className:"user-panel",children:[Object(y.jsx)(k,{photo:c.user.photo}),c.user.username]}),Object(y.jsx)("div",{className:"logout-panel",children:Object(y.jsx)(xe,{})})]}),Object(y.jsx)("div",{className:"chat-form-panel",children:Object(y.jsx)(he,{})}),Object(y.jsx)("div",{className:"side-menu",children:Object(y.jsx)(Oe,{})})]}),Object(y.jsx)("div",{className:"main",children:a?Object(y.jsx)(re,{}):Object(y.jsx)("div",{className:"empty-main",children:Object(y.jsx)(me.a,{fluid:!0,children:Object(y.jsx)(fe.a,{fluid:!0,children:Object(y.jsx)("h1",{className:"display-4",children:"Select chat room or create one"})})})})})]})})}),Object(y.jsx)(se.b,{exact:!0,path:"/auth",children:Object(y.jsx)("div",{className:"auth-page",children:Object(y.jsx)(be,{})})})]})})})};c(84);o.a.render(Object(y.jsx)(r.a.StrictMode,{children:Object(y.jsx)(E,{children:Object(y.jsx)(Ce,{})})}),document.getElementById("root")),i()}},[[85,1,2]]]);
//# sourceMappingURL=main.a95bc702.chunk.js.map