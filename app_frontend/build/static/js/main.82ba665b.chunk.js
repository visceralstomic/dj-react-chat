(this.webpackJsonpapp_frontend=this.webpackJsonpapp_frontend||[]).push([[0],{70:function(e,t,c){},71:function(e,t,c){},87:function(e,t,c){},88:function(e,t,c){},89:function(e,t,c){"use strict";c.r(t);var a,n=c(1),r=c.n(n),s=c(17),o=c.n(s),i=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,110)).then((function(t){var c=t.getCLS,a=t.getFID,n=t.getFCP,r=t.getLCP,s=t.getTTFB;c(e),a(e),n(e),r(e),s(e)}))},u=c(8),j=c(22),d=c(6),l=function(e,t){switch(t.type){case"SET_USER":return Object(d.a)(Object(d.a)({},e),{},{user:{uid:t.data.id,username:t.data.username,photo:t.data.photo},loading:!1});case"LOGOUT":return{chat:{currentRoom:null,rooms:[],participants:[]},user:{uid:"",username:"",photo:""},loading:!0};default:return e}},b=c(20),O={user:{uid:"",username:"",photo:null},chat:{currentRoom:null,rooms:[],participants:[]},loading:!0},h=(a={chat:function(e,t){switch(t.type){case"SET_CHAT_ROOM":return Object(d.a)(Object(d.a)({},e),{},{chat:Object(d.a)(Object(d.a)({},e.chat),{},{currentRoom:t.data})});case"ADD_CHAT_ROOM":return Object(d.a)(Object(d.a)({},e),{},{chat:Object(d.a)(Object(d.a)({},e.chat),{},{rooms:[].concat(Object(b.a)(e.chat.rooms),[t.data])})});case"SET_ROOM_LIST":return Object(d.a)(Object(d.a)({},e),{},{chat:Object(d.a)(Object(d.a)({},e.chat),{},{rooms:t.data})});case"DELETE_ROOM":var c=e.chat.rooms.filter((function(e){return e.id!==t.data.id}));return Object(d.a)(Object(d.a)({},e),{},{chat:{currentRoom:null,rooms:c,participants:[]}});case"SET_PARTICIPANTS":return Object(d.a)(Object(d.a)({},e),{},{chat:Object(d.a)(Object(d.a)({},e.chat),{},{participants:t.data})});case"ADD_PARTICIPANT":return Object(d.a)(Object(d.a)({},e),{},{chat:Object(d.a)(Object(d.a)({},e.chat),{},{participants:[].concat(Object(b.a)(e.chat.participants),[t.data])})});case"DELETE_PARTICIPANT":var a=e.chat.participants.filter((function(e){return e.id!==t.data.id}));return Object(d.a)(Object(d.a)({},e),{},{chat:Object(d.a)(Object(d.a)({},e.chat),{},{participants:a})});case"SET_NO_ROOM":return Object(d.a)(Object(d.a)({},e),{},{chat:Object(d.a)(Object(d.a)({},e.chat),{},{currentRoom:null})});default:return e}},user:l},function(e,t){return Object.keys(a).reduce((function(e,c){return Object(d.a)(Object(d.a)({},e),a[c](Object(j.a)({},c,e[c]),t))}),e)}),m=c(41),f=c.n(m),p="".concat("wss","://").concat(""),x="".concat("https","://").concat(""),g=f.a.create({baseURL:x,withCredentials:!0,xsrfHeaderName:"X-CSRFToken",xsrfCookieName:"csrftoken"}),v=function(e){return g.post("/users/login/",e).then((function(e){return e.data}))},S=function(){return g.get("/users/logout/").then((function(e){return e.data}))},N=function(){return g.get("/users/get_user/").then((function(e){return e.data}))},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return g.get("/users/?".concat(e)).then((function(e){return e.data}))},T=function(e){return g.post("/users/",e,{headers:{"content-type":"multipart/form-data"}}).then((function(e){return e.data}))},w=c(2),y=Object(n.createContext)(),R=function(e){var t=e.children,c=Object(n.useReducer)(h,O),a=Object(u.a)(c,2),r=a[0],s=a[1];return Object(n.useEffect)((function(){localStorage.getItem("IsLoggedIn")&&N().then((function(e){s({type:"SET_USER",data:{id:e.id,username:e.username,photo:e.photo}})})).catch((function(e){console.error(e)}))}),[]),Object(w.jsx)(y.Provider,{value:[r,s],children:t})},E=(c(69),c(70),c(71),c(16)),_=function(e){var t=e.photo;return Object(w.jsx)(w.Fragment,{children:null!==t?Object(w.jsx)("img",{className:"user-photo",src:"".concat(t),width:"37",height:"37",alt:"img"}):Object(w.jsx)(E.d,{className:"alt-user-photo"})})},k=function(e){return new Intl.DateTimeFormat("en-US",{dateStyle:"short",timeStyle:"short"}).format(new Date(e))},I=function(e){var t=e.author,c=e.text,a=e.user,n=e.date;return Object(w.jsxs)("div",{className:"chat-message ".concat(t.id===a.uid?"sender":""),children:[Object(w.jsx)(_,{photo:(t.photo,t.photo)}),Object(w.jsxs)("div",{className:"message-text",children:[Object(w.jsx)("div",{className:"info-username",children:t.username}),c,Object(w.jsx)("div",{className:"info-date",children:k(n)})]})]})},A=function(e){return g.post("/chat/room/",e).then((function(e){return e.data}))},L=function(){return g.get("/chat/room/").then((function(e){return e.data}))},P=function(e){return g.post("/chat/participant/",e).then((function(e){return e.data}))},D=function(e){return g.get("/chat/participant/?room_id=".concat(e)).then((function(e){return e.data}))},F=function(e){return g.delete("/chat/room/".concat(e)).then((function(e){return e.data}))},M=function(e){return console.log("delete",typeof e),g.delete("/chat/participant/".concat(e)).then((function(e){return e.data}))},U=c(90),H=c(91),J=function(){var e=Object(n.useContext)(y),t=Object(u.a)(e,2),c=t[0],a=t[1],r=c.chat.currentRoom,s=c.chat.participants;return Object(w.jsx)(U.a,{className:"partic-list",children:s.map((function(e){return Object(w.jsxs)(H.a,{className:"partic-item",children:[e.user.username,e.user.id===r.creator.id?Object(w.jsx)(E.b,{style:{color:"hsl(353, 59%, 43%)"}}):c.user.uid===r.creator.id?Object(w.jsx)(E.c,{onClick:function(t){return c=e.id,void(window.confirm("Are you sure you want to delete this user from this room?")&&M(c).then((function(e){a({type:"DELETE_PARTICIPANT",data:{id:c}})})).catch((function(e){console.error(e)})));var c},style:{color:"hsl(350, 99%, 50%)",cursor:"pointer"}}):null]},e.id)}))})},G=c(94),B=c(92),q=c(93),z=function(){var e=Object(n.useContext)(y),t=Object(u.a)(e,2),c=t[0],a=t[1],r=Object(n.useState)([]),s=Object(u.a)(r,2),o=s[0],i=s[1],j=c.chat.currentRoom;Object(n.useEffect)((function(){j&&C("part_room=".concat(j.id)).then((function(e){i(e.map((function(e){return Object(d.a)(Object(d.a)({},e),{},{toAdd:!1})})))})).catch((function(e){console.log(e)}))}),[j]);var l=function(e){var t=e.target,c=t.checked,a=t.value;i(o.map((function(e){return e.id===parseInt(a)?Object(d.a)(Object(d.a)({},e),{},{toAdd:c}):e})))};return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(U.a,{className:"partic-list",children:o.length>0?o.map((function(e){return Object(w.jsx)(H.a,{className:"partic-item",children:Object(w.jsxs)(B.a,{check:!0,children:[Object(w.jsx)(q.a,{value:e.id,type:"checkbox",checked:o.toAdd,onChange:l}),e.username]})},e.id)})):Object(w.jsx)("div",{children:"There are no users to add"})}),Object(w.jsx)(G.a,{onClick:function(e){if(window.confirm("Are you sure you want to add this user(s) to the room ?")){var t=[];for(var n in o)o[n].toAdd&&t.push(P({user:o[n].id,room:c.chat.currentRoom.id}));Promise.all(t).then((function(e){e.forEach((function(e){var t=o.find((function(t){return t.id===e.user}));delete t.toAdd;var c={id:e.id,user:t,room:e.room};i((function(t){return t.filter((function(t){return t.id!==e.user}))})),a({type:"ADD_PARTICIPANT",data:c})}))}))}},disabled:0===o.length&&!0,children:"Add users to room"})]})},V=c(109),W=c(95),X=c(96),K=c(97),Q=c(98),Y=c(99),Z=c(100),$=c(101),ee=c(102),te=c(5),ce=c.n(te),ae=function(e){var t=e.show,c=e.setShow,a=Object(n.useState)("1"),r=Object(u.a)(a,2),s=r[0],o=r[1],i=Object(n.useContext)(y),j=Object(u.a)(i,2),d=j[0],l=j[1],b=function(e){s!==e&&o(e)},O=function(){return c(!1)};return Object(w.jsxs)(V.a,{isOpen:t,size:"sm",toggle:O,backdrop:"static",centered:!0,keyboard:!1,children:[Object(w.jsx)(W.a,{toggle:O,children:"Room menu"}),Object(w.jsxs)(X.a,{children:[Object(w.jsxs)(K.a,{tabs:!0,children:[Object(w.jsx)(Q.a,{className:"tab-item",children:Object(w.jsx)(Y.a,{className:"".concat(ce()({active:"1"===s})," text-dark"),onClick:function(){b("1")},children:"Participants"})}),d.user.uid===d.chat.currentRoom.creator.id?Object(w.jsx)(Q.a,{className:"tab-item",children:Object(w.jsx)(Y.a,{className:"".concat(ce()({active:"2"===s})," text-dark"),onClick:function(){b("2")},children:"Users"})}):null]}),Object(w.jsxs)(Z.a,{activeTab:s,children:[Object(w.jsx)($.a,{tabId:"1",children:Object(w.jsx)(U.a,{className:"partic-list",children:Object(w.jsx)(J,{})})}),d.user.uid===d.chat.currentRoom.creator.id?Object(w.jsx)($.a,{tabId:"2",children:Object(w.jsx)(U.a,{className:"partic-list",children:Object(w.jsx)(z,{})})}):null]})]}),Object(w.jsxs)(ee.a,{children:[d.user.uid===d.chat.currentRoom.creator.id?Object(w.jsx)(G.a,{color:"danger",onClick:function(e){window.confirm("Are you sure you want to delete this room ?")&&F(d.chat.currentRoom.id).then((function(e){l({type:"DELETE_ROOM",data:{id:d.chat.currentRoom.id}})}))},children:"Delete"}):null,Object(w.jsx)(G.a,{variant:"secondary",onClick:O,children:"Close"})]})]})},ne=function(e){var t=Object(n.useState)([]),c=Object(u.a)(t,2),a=c[0],r=c[1],s=Object(n.useState)(""),o=Object(u.a)(s,2),i=o[0],j=o[1],d=Object(n.useState)(!1),l=Object(u.a)(d,2),O=l[0],h=l[1],m=Object(n.useContext)(y),f=Object(u.a)(m,2),x=f[0],g=f[1],v=Object(n.useState)(!1),S=Object(u.a)(v,2),N=(S[0],S[1],Object(n.useState)(!1)),C=Object(u.a)(N,2),T=(C[0],C[1],Object(n.useRef)(null)),R=Object(n.useRef)(),_=x.chat.currentRoom;Object(n.useEffect)((function(){R.current.scrollIntoView({behavior:"auto"})}),[a]),Object(n.useEffect)((function(){_&&D(_.id).then((function(e){g({type:"SET_PARTICIPANTS",data:e})})),j(""),h(!1)}),[_]),Object(n.useEffect)((function(){return T.current=new WebSocket("".concat(p,"/ws/chat/").concat(_.id,"/")),T.current.addEventListener("open",(function(e){console.log("OPEN!"),T.current.send(JSON.stringify({command:"fetch_messages"}))})),T.current.addEventListener("close",(function(e){console.error(e)})),T.current.addEventListener("message",(function(e){var t=JSON.parse(e.data);switch(t.command){case"messages":r(t.messages);break;case"new_message":r((function(e){return[].concat(Object(b.a)(e),[t.message])})),j("")}})),function(){return T.current.close()}}),[_]);return Object(w.jsxs)("div",{className:"chat-area",children:[Object(w.jsxs)("div",{className:"chat-header",children:[Object(w.jsx)(E.a,{onClick:function(){g({type:"SET_NO_ROOM"})},className:"to-side-bar"}),_.name,Object(w.jsx)("div",{className:"header-buttons",children:Object(w.jsx)(G.a,{onClick:function(){return h(!0)},children:"Menu"})})]}),Object(w.jsxs)("div",{className:"chat-log",children:[a.map((function(e){return Object(w.jsx)(I,{author:e.author,text:e.text,user:x.user,date:e.create_date},e.create_date)})),Object(w.jsx)("div",{style:{float:"left",clear:"both"},ref:R})]}),Object(w.jsxs)("div",{className:"chat-input-panel",children:[Object(w.jsx)("textarea",{className:"message-input",value:i,onChange:function(e){var t=e.target;return j(t.value)},type:"text",cols:"30",rows:"1"}),Object(w.jsx)(G.a,{onClick:function(e){""!==i.trim()&&T.current.send(JSON.stringify({message:i,command:"new_message",from:{id:x.user.uid,username:x.user.username}}))},children:"Send"})]}),Object(w.jsx)(ae,{show:O,setShow:h})]})},re=c(11),se=c(103),oe=c(104),ie=function(e){var t=e.toggle,c=e.setToggle,a=Object(n.useContext)(y),r=Object(u.a)(a,2),s=(r[0],r[1]),o=Object(n.useState)(""),i=Object(u.a)(o,2),j=i[0],d=i[1],l=Object(n.useState)(""),b=Object(u.a)(l,2),O=b[0],h=b[1],m=Object(n.useState)(null),f=Object(u.a)(m,2),p=f[0],x=f[1],g=Object(re.g)(),S=(Object(re.h)().state||{from:{pathname:"/"}}).from;return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("h3",{children:"Login"}),Object(w.jsxs)(se.a,{onSubmit:function(e){e.preventDefault(),v({username:j,password:O}).then((function(e){s({type:"SET_USER",data:{id:e.id,username:e.username,photo:e.photo}}),localStorage.setItem("IsLoggedIn",!0),g.replace(S)})).catch((function(e){x(e.response.data.error),setTimeout((function(){x(null)}),7e3)}))},children:[Object(w.jsxs)(oe.a,{children:[Object(w.jsx)(B.a,{for:"usernameinput",children:"Username"}),Object(w.jsx)(q.a,{id:"usernameinput",type:"text",value:j,onChange:function(e){var t=e.target;return d(t.value)},invalid:null!==p})]}),Object(w.jsxs)(oe.a,{children:[Object(w.jsx)(B.a,{for:"passwordinput",children:"Password"}),Object(w.jsx)(q.a,{id:"passwordinput",type:"password",value:O,onChange:function(e){var t=e.target;return h(t.value)},invalid:null!==p})]}),p?Object(w.jsx)(oe.a,{className:"error-message",children:p}):null,Object(w.jsxs)(oe.a,{className:"form-btns",children:[Object(w.jsx)(G.a,{children:"Log in"}),Object(w.jsxs)("span",{children:["Not registered ?  ",Object(w.jsx)("br",{}),"  Then ",Object(w.jsx)("span",{className:"auth-toggle",onClick:function(){return c(!t)},children:"Sign up"})]})]})]})]})},ue=c(105),je=function(e){var t=e.message;return Object(w.jsx)(ue.a,{children:t})},de=function(e){var t=e.toggle,c=e.setToggle,a=Object(n.useState)(""),r=Object(u.a)(a,2),s=r[0],o=r[1],i=Object(n.useState)(""),j=Object(u.a)(i,2),d=j[0],l=j[1],b=Object(n.useState)(""),O=Object(u.a)(b,2),h=O[0],m=O[1],f=Object(n.useState)(null),p=Object(u.a)(f,2),x=p[0],g=p[1],v=Object(n.useState)(void 0),S=Object(u.a)(v,2),N=S[0],C=S[1],y=Object(n.useState)(void 0),R=Object(u.a)(y,2),E=R[0],_=R[1],k=Object(n.useState)(void 0),I=Object(u.a)(k,2),A=I[0],L=I[1],P=Object(n.useState)(void 0),D=Object(u.a)(P,2),F=D[0],M=D[1],U=Object(n.useState)(null),H=Object(u.a)(U,2),J=H[0],z=H[1];return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("h3",{children:"Register"}),Object(w.jsxs)(se.a,{onSubmit:function(e){e.preventDefault();var a=new FormData;a.append("username",s),a.append("password",d),a.append("password2",h),x&&(console.log(x),a.append("photo",x,x.name)),C(void 0),_(void 0),L(void 0),M(void 0),z(null),T(a).then((function(e){c(!t)})).catch((function(e){for(var t in console.log(e.response.data),e.response.data)switch(t){case"username":C(e.response.data[t]);break;case"password":_(e.response.data[t]);break;case"password2":L(e.response.data[t]);break;case"photo":M(e.response.data[t]);break;default:z(e.response.data[t])}}))},children:[Object(w.jsxs)(oe.a,{children:[Object(w.jsx)(B.a,{for:"usernameinput",children:"Username"}),Object(w.jsx)(q.a,{id:"usernameinput",type:"text",value:s,onChange:function(e){var t=e.target;return o(t.value)},invalid:void 0!==N}),N?Object(w.jsx)(je,{message:N}):null]}),Object(w.jsxs)(oe.a,{children:[Object(w.jsx)(B.a,{for:"passwordinput",children:"Password"}),Object(w.jsx)(q.a,{id:"passwordinput",type:"password",value:d,onChange:function(e){var t=e.target;return l(t.value)},invalid:void 0!==E||null!==J}),E?Object(w.jsx)(je,{message:E}):null]}),Object(w.jsxs)(oe.a,{children:[Object(w.jsx)(B.a,{for:"passwor2dinput",children:"Repeat password"}),Object(w.jsx)(q.a,{id:"passwor2dinput",type:"password",value:h,onChange:function(e){var t=e.target;return m(t.value)},invalid:void 0!==A||null!==J}),A?Object(w.jsx)(je,{message:A}):null,J?Object(w.jsx)(je,{message:J}):null]}),Object(w.jsxs)(oe.a,{children:[Object(w.jsx)(B.a,{for:"userPhoto",children:"Photo"}),Object(w.jsx)(q.a,{type:"file",name:"file",id:"userPhoto",accept:"image/*",onChange:function(e){var t=e.target;return g(t.files[0])},invalid:void 0!==F}),F?Object(w.jsx)(je,{message:F}):null]}),Object(w.jsxs)(oe.a,{className:"form-btns",children:[Object(w.jsx)(G.a,{color:"success",children:"Create account"}),Object(w.jsxs)("span",{children:["Already registered?  ",Object(w.jsx)("br",{}),"Then ",Object(w.jsx)("span",{className:"auth-toggle",onClick:function(){return c(!t)},children:"Log in"})]})]})]})]})},le=function(e){var t=Object(n.useState)(!1),c=Object(u.a)(t,2),a=c[0],r=c[1];return Object(w.jsx)("div",{className:"auth-container",children:a?Object(w.jsx)(de,{toggle:a,setToggle:r}):Object(w.jsx)(ie,{toggle:a,setToggle:r})})},be=(c(87),function(e){var t=Object(n.useContext)(y),c=Object(u.a)(t,2),a=c[0],r=c[1];return Object(n.useEffect)((function(){L().then((function(e){r({type:"SET_ROOM_LIST",data:e})})).catch((function(e){console.error(e)}))}),[]),Object(w.jsx)("div",{className:"room-list",children:a.chat.rooms.map((function(e){var t={borderLeft:e.creator.id===a.user.uid?"15px solid hsl(353, 59%, 43%)":""};return Object(w.jsxs)("button",{style:t,onClick:function(){return r({type:"SET_CHAT_ROOM",data:e})},children:[e.name," ",e.creator.id===a.user.uid?Object(w.jsx)(E.b,{style:{color:"hsl(353, 59%, 43%)"}}):null]},e.id)}))})}),Oe=function(e){var t=Object(n.useContext)(y),c=Object(u.a)(t,2),a=c[0],r=c[1],s=Object(n.useState)(""),o=Object(u.a)(s,2),i=o[0],j=o[1],l=Object(n.useState)(null),b=Object(u.a)(l,2),O=b[0],h=b[1];return Object(w.jsx)(w.Fragment,{children:Object(w.jsxs)(se.a,{onSubmit:function(e){e.preventDefault(),""!==i.trim()&&A({name:i}).then((function(e){r({type:"ADD_CHAT_ROOM",data:Object(d.a)(Object(d.a)({},e),{},{creator:{id:a.user.uid,username:a.user.username}})}),j("")})).catch((function(e){h(e.response.data.name)}))},children:[Object(w.jsxs)(oe.a,{className:"position-relative chat-form-input",children:[Object(w.jsx)(q.a,{value:i,onChange:function(e){null!==O&&h(null),j(e.target.value)},placeholder:"Add chat room",invalid:null!==O,required:!0}),Object(w.jsx)(ue.a,{tooltip:!0,children:O})]}),Object(w.jsx)(oe.a,{children:Object(w.jsx)(G.a,{children:"Enter"})})]})})},he=c(106),me=c(107),fe=c(108),pe=function(e){var t=Object(n.useContext)(y),c=Object(u.a)(t,2),a=(c[0],c[1]),r=Object(re.g)();return Object(w.jsx)("div",{children:Object(w.jsx)(G.a,{onClick:function(e){S().then((function(e){a({type:"LOGOUT"}),console.log("LOGOUT"),localStorage.removeItem("IsLoggedIn"),r.replace("/auth")})).catch((function(e){console.log(e)}))},children:"Logout"})})},xe=c(18),ge=c(44),ve=["children","auth"],Se=function(e){var t=e.children,c=(e.auth,Object(ge.a)(e,ve)),a=localStorage.getItem("IsLoggedIn");return Object(w.jsx)(re.b,Object(d.a)(Object(d.a)({},c),{},{render:function(e){var c=e.location;return a?t:Object(w.jsx)(re.a,{to:{pathname:"/auth",state:{from:c}}})}}))},Ne=function(){var e=Object(n.useContext)(y),t=Object(u.a)(e,2),c=t[0],a=(t[1],c.chat.currentRoom);return Object(w.jsx)("div",{className:"app",children:Object(w.jsx)(xe.a,{children:Object(w.jsxs)(re.d,{children:[Object(w.jsx)(Se,{exact:!0,path:"/",children:Object(w.jsx)("div",{className:"chat-container ".concat(c.chat.currentRoom?"active-room":"no-active-room"),children:c.loading?Object(w.jsx)("div",{className:"loader",children:Object(w.jsx)(fe.a,{color:"dark"})}):Object(w.jsxs)(w.Fragment,{children:[Object(w.jsxs)("div",{className:"side-bar",children:[Object(w.jsxs)("div",{className:"side-header",children:[Object(w.jsxs)("div",{className:"user-panel",children:[Object(w.jsx)(_,{photo:c.user.photo}),c.user.username]}),Object(w.jsx)("div",{className:"logout-panel",children:Object(w.jsx)(pe,{})})]}),Object(w.jsx)("div",{className:"chat-form-panel",children:Object(w.jsx)(Oe,{})}),Object(w.jsx)("div",{className:"side-menu",children:Object(w.jsx)(be,{})})]}),Object(w.jsx)("div",{className:"main",children:a?Object(w.jsx)(ne,{}):Object(w.jsx)("div",{className:"empty-main",children:Object(w.jsx)(he.a,{fluid:!0,children:Object(w.jsx)(me.a,{fluid:!0,children:Object(w.jsx)("h1",{className:"display-4",children:"Select chat room or create one"})})})})})]})})}),Object(w.jsx)(re.b,{exact:!0,path:"/auth",children:Object(w.jsx)("div",{className:"auth-page",children:Object(w.jsx)(le,{})})})]})})})};c(88);o.a.render(Object(w.jsx)(r.a.StrictMode,{children:Object(w.jsx)(R,{children:Object(w.jsx)(Ne,{})})}),document.getElementById("root")),i()}},[[89,1,2]]]);
//# sourceMappingURL=main.82ba665b.chunk.js.map